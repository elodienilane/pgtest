<!DOCTYPE html>
<!--[if IEMobile 7 ]>    <html class="no-js iem7"> <![endif]-->
<!--[if (gt IEMobile 7)|!(IEMobile)]><!--> <html class="no-js"> <!--<![endif]-->
    <head>
        <meta charset="utf-8">
        <title></title>
        <meta name="description" content="">
        <meta name="HandheldFriendly" content="True">
        <meta name="MobileOptimized" content="320">
        <meta name="viewport" content="width-device-width, user-scalable=no">
        <meta http-equiv="cleartype" content="on">

        <link rel="apple-touch-icon-precomposed" sizes="144x144" href="img/touch/apple-touch-icon-144x144-precomposed.png">
        <link rel="apple-touch-icon-precomposed" sizes="114x114" href="img/touch/apple-touch-icon-114x114-precomposed.png">
        <link rel="apple-touch-icon-precomposed" sizes="72x72" href="img/touch/apple-touch-icon-72x72-precomposed.png">
        <link rel="apple-touch-icon-precomposed" href="img/touch/apple-touch-icon-57x57-precomposed.png">
        <link rel="shortcut icon" href="img/touch/apple-touch-icon.png">

        <!-- For iOS web apps. Delete if not needed. https://github.com/h5bp/mobile-boilerplate/issues/94 -->
        <!--
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">
        -->
        
        <!-- This script prevents links from opening in Mobile Safari. https://gist.github.com/1042026 -->
        <!--
        <script>(function(a,b,c){if(c in b&&b[c]){var d,e=a.location,f=/^(a|html)$/i;a.addEventListener("click",function(a){d=a.target;while(!f.test(d.nodeName))d=d.parentNode;"href"in d&&(d.href.indexOf("http")||~d.href.indexOf(e.host))&&(a.preventDefault(),e.href=d.href)},!1)}})(document,window.navigator,"standalone")</script>
        -->

        <link rel="stylesheet" href="normalize.css">
        <link rel="stylesheet" href="main.css">
                
        <script src="js/vendor/modernizr-2.6.1.min.js"></script>
        <script src="js/helper.js"></script>
         <!--<script src="http://gettopup.com/releases/latest/top_up-min.js" type="text/javascript"></script>-->
        <script src="js/mootools-core-1.4.5-full-compat-yc.js"></script>
        <script src="js/vendor/jquery-1.7.2.min.js"></script>
        
        <script>
            parseJson();
			
            postsArray = [];
			templateClass = "template";
			indexes = [];
			shownTemplates = [];
			unique = 0;
			chunkHeight = 0;
			
            <!-- Parse Json to get all posts and images -->
            function parseJson(){
                $.get("http://localhost:8080/PortFolio/wordpress/?json=get_recent_posts&dev=1", function(json){
                    var deJson = jQuery.parseJSON(json);
                    var posts = deJson.posts;
                    var count = deJson.count;
                    
                    $.each(posts, function( intIndex, post ){
                        var images = post.attachments[0].images;
                        var postVal = {
                                        title       : post.title, 
                                        fullimg     : images.full.url,
                                        smallthumb  : images.smallthumb.url,
                                        bigthumb    : images.bigthumb.url,
                                        widethumb   : images.widethumb.url,
                                        highthumb   : images.highthumb.url
                                    };
                        postsArray.push(postVal);
                        indexes.push({intIndex : 0});
                    });
                    
                    var loopIndexes = new Array(0, 1, 2, 3);
                    loopIndexes.each(function(index) {
						newTemplate("bottom");
                    });
					                jQuery(window).scrollTop(600);

                });
            }
            
            <!--Check if all templates have been loaded before generating wall-->            
            function newTemplate(position) {
				unique++;
				var templateID = "template"+unique;
				var toLoad = "templates/template"+((unique%4)+1)+".html";
				$.ajax({
					url: toLoad,
					type: "GET",
					datatype: 'html',
					async: false,
					success: function (response) {
						if(postsArray.length == 0){
							alert("No content to display");
						} else {
							var newdiv = document.createElement('div');
							newdiv.className = templateClass;
							newdiv.setAttribute("id", templateID);
							//newdiv.setAttribute("id", templateID);
							newdiv.innerHTML = response;
							if(position == "bottom"){
								$("#thumbs-container").append(newdiv);
								shownTemplates.push(templateID);
							} else if(position == "top"){
								$("#thumbs-container").prepend(newdiv);
								shownTemplates.unshift(templateID);
							}
			                generateWall(postsArray, indexes, templateID);
						}
					}
				});
            }
            
            <!--Generate template -->
            function generateWall(postsArray, indexes, container){
                var count = postsArray.length;

                var tdsmallcount = 0;
                var tdbigcount = 0;
                var tdwidecount = 0;
                var tdhighcount = 0;
                
                var min = 0;
                var toChoose = [];
                
                for(i = 0; i<count; i++){
                    toChoose.push(i);
                }

                var classT = "#"+container;
                
                $(classT).find("td").each(function(index) { //get all cells in table
                    var source = null;
                    
                    var max = toChoose.length - 1;
                    var index = Math.floor(Math.random() * (max - min + 1)) + min;
                    
                    if(toChoose.length == 0){
                        for(i = 0; i<count; i++){
                            toChoose.push(i);
                        }
                    }
                    var random = toChoose[index];
                    toChoose.splice(index,1);
                                        
                    switch($(this).attr('class')) {
                        case 'tdsmall':
                            source = postsArray[random].smallthumb;
                            tdsmallcount++;
                        break;
                        case 'tdbig':
                            source = postsArray[random].bigthumb;
                            tdbigcount++;
                        break;
                        case 'tdhigh':
                            source = postsArray[random].highthumb;
                            tdhighcount++;
                        break;
                        case 'tdwide':
                            source = postsArray[random].widethumb;
                            tdwidecount++;
                        break;
                    }
                    $('<img/>') // create img
                        .attr({ // set attributes
                            src: source
                    })
                    .appendTo($(this)); // append to chat box

                });
				chunkHeight = $(classT).height();
            }
        </script>

    </head>
    
    <body>
        <!-- Add your site or application content here -->
        <div id="thumbs-container"></div>
        
        <!--Add link to all images for popup-->
        <script>
            $('img.web-thumb').each( function() {
                var $img = $(this),
                href = $img.attr('src');
                
                var name = href.replace(/^.*\/|\.jpg$/g, '');
                $img.wrap('<a href="img/full-views/' + name+".jpg" + '" class="top_up"></a>');
            });
        </script>

        <!--Set image sizes according to viewport-->
        <script type="text/javascript">
            jQuery(document).ready(function() {
                if (typeof( window.innerHeight ) == 'number' ) {
                    var vpHeight = window.innerHeight;
                    var vpWidth = window.innerWidth;
                }
                //document.getElementById("demo").innerHTML=", Image Width After: "+imgWidth;
                
                var img = document.images;
                var scale = 0.20;
                
                for (var i = 0; i < img.length; i++) {
                    var ratio = img[i].width/(vpWidth*scale);
                    var oldWidth = img[i].width;
                    var oldHeight = img[i].height;
                    var cellWidth =  vpWidth*scale;
                    var parent = (img[i].parentNode).parentNode.className;
                    
                    if(parent == "tdsmall"){
                        img[i].width = vpWidth*scale;  
                        img[i].height = img[i].width;
                    } else if (parent == "tdbig"){
                        img[i].width = vpWidth*scale*2;  
                        img[i].height = img[i].width;
                    } else if (parent == "tdwide"){
                        img[i].width = vpWidth*scale*2;  
                        img[i].height = img[i].width /2;
                    } else if (parent == "tdhigh"){
                        img[i].height = vpWidth*scale*2;
                        img[i].width = img[i].height /2;  
                    }
                }
            });
        </script>

        <!--Move the viewport to desired element-->
        <script>
            jQuery(document).ready(function() {
                /*var viewportWidth = jQuery(window).width(),
                viewportHeight = jQuery(window).height(),
                $foo = jQuery('#blue'),
                elWidth = $foo.width(),
                elHeight = $foo.height(),
                elOffset = $foo.offset();
                jQuery(window).scrollTop(elOffset.top);
                jQuery(window).scrollLeft(elOffset.left  - (elWidth/2));*/
            });
        </script>
        
        <script type="text/javascript">
            $(window).scroll(function () {
                $('#more').hide();
                $('#no-more').hide();
                if ($(window).scrollTop() + $(window).height() > $(document).height() - 500) {
                    var viewTop = $( window ).scrollTop();
					newTemplate("bottom");
					var first = shownTemplates[0];
					//alert(viewTop+chunkHeight)
					$( window ).scrollTop( viewTop - chunkHeight );
					//alert(first);
					$('#'+first).remove();
					shownTemplates.shift();
					//alert(shownTemplates);
                   	//newTemplate(shownTemplates.length+1);
                    var min = 0;
                    var max = toLoadTemplates;
                    
                }
				if ($(window).scrollTop() < 500) {
                    /*$('#more').css("top", "400");
                    $('#more').show();*/
					var last = shownTemplates[shownTemplates.length-1];

					$('#'+last).remove();
					shownTemplates.splice(shownTemplates.length-1,1);
					
                    var viewTop = $( window ).scrollTop();
					newTemplate("top");
					$( window ).scrollTop( viewTop + chunkHeight );
					var first = shownTemplates[0];

					//alert(first);
					/*$('#'+first).remove();
					shownTemplates.shift();*/
                    
                }
                /*if ($(window).scrollTop() + $(window).height() == $(document).height()) {
        
                    $('#more').hide();
                    $('#no-more').hide();
        
                    page++;
                    alert(page);
                    var data = {
                        page_num: page
                    };
                    $("#result").append("new content");
                    
                    var min = 0;
                    var max = toLoadTemplates;
                    var newTemplate = Math.floor(Math.random() * (max - min + 1)) + min;
                    alert(newTemplate);
                }*/
        
            });
        </script>
        
        <!-- Google Analytics: change UA-XXXXX-X to be your site's ID. -->
        <!-- <script>
            var _gaq=[["_setAccount","UA-XXXXX-X"],["_trackPageview"]];
            (function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];g.async=1;
            g.src=("https:"==location.protocol?"//ssl":"//www")+".google-analytics.com/ga.js";
            s.parentNode.insertBefore(g,s)}(document,"script"));
        </script> -->
    </body>
</html>
